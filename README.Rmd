---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# idswb <a href="https://teal-insights.github.io/idswb/"><img src="man/figures/logo.png" align="right" height="139" alt="idswb website" /></a>

<!-- badges: start -->
[![R-CMD-check](https://github.com/Teal-Insights/idswb/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/Teal-Insights/idswb/actions/workflows/R-CMD-check.yaml)
[![LifeCycle](https://img.shields.io/badge/lifecycle-experimental-orange)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Test coverage](https://github.com/Teal-Insights/idswb/actions/workflows/test-coverage.yaml/badge.svg)](https://github.com/Teal-Insights/idswb/actions/workflows/test-coverage.yaml)
[![License: CC0](https://img.shields.io/badge/License-CC0-lightgrey.svg)](https://choosealicense.com/licenses/cc0-1.0/)
[![Website](https://github.com/Teal-Insights/idswb/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/Teal-Insights/idswb/actions/workflows/pkgdown.yaml)
<!-- badges: end -->
```{r}

```

`idswb` is primarily a data package enabling an efficient method for working with [International Debt Statistics from World Bank](https://www.worldbank.org/en/programs/debt-statistics/ids) in R.

## Installation

You can install the development version of idswb from [GitHub](https://github.com/) with:

``` r
# setting options
options(timeout = 600, scipen = 999)

# install.packages("devtools")
devtools::install_github("Teal-Insights/idswb")
```

This package will likely never be published on [CRAN](https://cran.r-project.org/) because the data file sizes are too big.


## Example

This is a basic example which shows you how to solve a common problem:

```{r warning=FALSE, message=FALSE}
library(idswb)
library(knitr)
library(tidyverse)
```

```{r}

```
## Overview of available datasets in idswb package


```{r}

```

* unique_counterpart_area: information on counterparts (creditors)  
```{r}
unique_counterpart_area %>% head() %>% kable()
```

```{r}

```

* unique_country: information on debtors     
```{r}
unique_country %>% head() %>% kable()
```

```{r}

```
* unique_series: information on series  
```{r}
unique_series %>% head() %>% kable()
```

```{r}

```
* unique_time: information on years                               

```{r}
unique_time %>% head() %>% kable()
```

```{r}

```
## creating an etl object

We create an ETL object by specifying a string that defines the object's class, and use the package `idswb` to gain access to the relevant data.
```{r}
# ceating an object
idswb_ob <-etl("idswb", dir = getwd())

```

```{r}

```

##  Extract

The first step here is to acquire data
```{r}
idswb_ob %>% etl_extract()
```

```{r}

```
## Transform

This data might require conversion from its original format into files that are appropriate for SQL import, typically in CSV format.
```{r}
idswb_ob %>% etl_transform()
```

```{r}

```
## Load

Fill the SQL database with the processed data.
```{r}
idswb_ob %>% etl_load()
```

```{r}

```
We can still perform the steps above at once
```{r eval=FALSE}
# ceating an object
idswb_ob <-etl("idswb", dir = getwd())

idswb_ob %>% 
  # extract
  etl_extract() %>% 
  # transform
  etl_transform() %>% 
  # load
  etl_load()
```

```{r}

```

```{r}

```
## Querying data

We can now query debt of a given country that it owes to both China and the World as follows using `get_debt()` function
```{r}
dplyr::tbl(idswb_ob, "ids_wb") %>% 
  # query data
  dplyr::filter(wb_debtor_country_name == "Kenya",
         wb_creditor_name %in% c("China","World"),
         api_code %in% c("DT.DOD.BLAT.CD",
                         "DT.DOD.PBND.CD",
                         'DT.DOD.MLAT.CD',
                         "DT.DOD.PROP.CD",
                         "DT.DOD.PCBK.CD",
                         "DT.DOD.DPPG.CD")) %>% 
  dplyr::collect() %>% 
  # gather data
  gather(key = year,value = debt,-c(api_code, data_last_updated, series_full_name, wb_debtor_country_name, wb_debtor_country_id,  
                                    wb_creditor_name, wb_creditor_id)) %>% 
  filter(year == 2022) %>% 
  mutate(data_last_updated = as_datetime(as.numeric(data_last_updated))) %>% 
  knitr::kable()
```

```{r}

```

```{r}
dplyr::tbl(idswb_ob, "ids_wb") %>% 
  # query data
  dplyr::filter(wb_debtor_country_name == "Nigeria",
         wb_creditor_name %in% c("China","World"),
         api_code %in% c("DT.DOD.BLAT.CD",
                         "DT.DOD.PBND.CD",
                         'DT.DOD.MLAT.CD',
                         "DT.DOD.PROP.CD",
                         "DT.DOD.PCBK.CD",
                         "DT.DOD.DPPG.CD")) %>% 
  dplyr::collect() %>% 
  # gather data
  gather(key = year,value = debt,-c(api_code, data_last_updated, series_full_name, wb_debtor_country_name, wb_debtor_country_id,  
                                    wb_creditor_name, wb_creditor_id)) %>% 
  filter(year == 2022) %>% 
  mutate(data_last_updated = as_datetime(as.numeric(data_last_updated))) %>% 
  knitr::kable()
```

